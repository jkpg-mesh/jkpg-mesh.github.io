<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="../assets/M-POWERED.png">
    <title>jkpg-mesh</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div id="navbar-placeholder"></div>
    <script>
        // Load navbar from external file
        fetch('navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar-placeholder').innerHTML = data;
            });
    </script>

    <div class="container-fluid d-flex justify-content-center align-items-center"
        style="background-image: url('assets/main.jpg'); height: 400px; background-size: cover; background-position: center;">
        <div class="position-relative w-100">
            <div id="cardCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="card mx-auto"
                            style="background-color: rgba(50, 50, 50, 0.6); border: 1px solid #ccc; border-radius: 10px; max-width: 800px; max-height: 380px;">
                            <div class="card-header bg-teal text-black text-center">
                                <h1 class="mb-0">Meshtastic Jkpgmesh Intro</h1>
                            </div>
                            <div class="card-body text-center text-white">
                                <div class="ratio" style="aspect-ratio: 16/9; height: 280px;">
                                    <iframe id="youtubeVideo1" src="https://www.youtube.com/embed/Xz6xcXjco0w?enablejsapi=1&version=3&rel=0"
                                        title="YouTube video" allowfullscreen style="height: 100%; width: 100%;"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="card mx-auto"
                            style="background-color: rgba(50, 50, 50, 0.6); border: 1px solid #ccc; border-radius: 10px; max-width: 800px; max-height: 400px;">
                            <div class="card-header bg-teal text-black text-center">
                                <h1 class="mb-0">Martins bygge med utsikt över Jönköping</h1>
                            </div>
                            <div class="card-body text-center text-white">
                                <p>Vår communitymedlem <strong>Martin (SM7UVT)</strong> har nyligen byggt en <strong>solcellsdriven Meshtastic-nod</strong>
                                    med målet att placera den vid <strong>Ekhagen Östra</strong>, med utsikt över Jönköping. Projektet har gått igenom flera
                                    iterationer, med hjälp från andra medlemmar i Discord-communityn.</p>
                                <a href="../blogs/blog5.html" class="btn text-black bg-teal btn-tealdark mt-3">Läs mer...</a>
                            </div>
                        </div>
                    </div>
                    </div>
                <button class="carousel-control-prev custom-arrow" type="button" data-bs-target="#cardCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next custom-arrow" type="button" data-bs-target="#cardCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container-fluid bg-teal text-center">
        <h1>Välkommen till Jönköping Meshtastics</h1>
        <p>jkpg-mesh är en informell gemenskap som verkar för ett stabilt Meshtastic-nätverk i Jönköpingsområdets.</p>
    </div>

    <div class="container-fluid text-center">
        <h1>Varför Meshtastic?</h1>
        <div class="mx-auto w-75 text-start">
            <p>Meshtastic är inte bara ännu en meddelandeapp - det är en port till en värld där öppen kommunikation
                möter praktiskt experimenterande. Även om många plattformar erbjuder mer polerade meddelandetjänster,
                är Meshtastic unikt i att det ger användare möjligheten att bygga och utöka sina egna decentraliserade
                nätverk med prisvärd hårdvara. Det handlar inte bara om att hålla kontakten, utan om att skapa robusta,
                direktanvända kommunikationssystem som fungerar där vanliga nätverk inte räcker - på bergstoppar,
                avlägsna vandringsleder, avkopplande stugor utan täckning och även vid kriser när infrastrukturen faller bort.</p>
            <p>Det som gör Meshtastic speciellt är hur det samlar en livlig gemenskap av antennbyggare, elektronikentusiaster,
                mikrokontrollfantaster och mjukvaruutvecklare. Oavsett om du gillar att löda egna kretskort, skriva egen
                firmware eller bara experimentera med mesh-nätverk, så välkomnar Meshtastic dig - och det krävs ingen
                amatörradiolicens. Det är en plattform som befinner sig i skärningspunkten mellan praktisk teknik och
                nyfikenhetsdriven utforskning - lika mycket för lärande som för kommunikation.</p>
        </div>
    </div>
    <div class="container-fluid text-center">
        <h1>Var börjar jag?</h1>
        <div class="mx-auto w-75 text-start">
            <p>Det bästa sättet att komma igång med Meshtastic är helt enkelt att skaffa en enhet, slå på den och se vad
                som händer. Du behöver ingen djup teknisk bakgrund eller någon form av licens - bara nyfikenhet. Ju fler
                som ansluter och slår på sina noder, desto starkare och mer användbart blir nätverket. Även om du inte
                hör någon direkt, så ökar din närvaro chansen för andra i närheten att få kontakt - och det är så nätverket växer.</p>
            <p>När du väl har börjat, ta gärna kontakt med andra som har experimenterat med Meshtastic ett tag. Det är en
                av anledningarna till att den här webbplatsen finns - att hjälpa lokala eller regionala entusiaster att
                hitta varandra, dela erfarenheter och lära sig tillsammans. Oavsett om du bygger en antenn eller vill
                förstå olika firmwareinställningar, så går det snabbare (och blir roligare) när man hjälps åt.</p>
            <p>Förutom lokalt stöd finns det också en växande mängd riktigt bra YouTube-videor och guider. Det finns
                en livlig onlinegemenskap som ständigt delar tips, genomgångar och nya idéer. Och självklart är den
                officiella <a href="https://meshtastic.org/">Meshtastic-webbplatsen</a> full av dokumentation, guider och forum som hjälper dig att fördjupa
                dig i din egen takt.</p>
        </div>
    </div>
    <div class="container-fluid text-center">
        <h1>Vilken enhetsroll ska jag välja?</h1>
        <div class="mx-auto w-75 text-start">
            <p>Att välja rätt enhetsroll i Meshtastic är viktigare än det först kan verka. Varje roll bestämmer hur din nod
                beter sig i nätverket - om den bara lyssnar, aktivt vidarebefordrar meddelanden, eller håller sig helt tyst
                för att spara ström. En korrekt inställd roll hjälper mesh-nätverket att fungera effektivt och gör din
                första upplevelse både enklare och roligare.</p>
            <p>För de flesta nybörjare är det bäst att börja med <strong>Client</strong> eller <strong>Client (Muted)</strong>.
                En Client är en enhet kopplad till appen eller som fungerar fristående. Den kan skicka och ta emot meddelanden,
                och vidarebefordrar även paket om ingen annan nod redan har gjort det. Den bidrar till nätverket utan att
                belasta det för mycket.</p>
            <p>En Client (Muted) däremot vidarebefordrar inte paket från andra noder. Den skickar och tar emot meddelanden
                precis som en vanlig klient, men deltar inte i routing. Den här rollen passar bra om du vill minska
                nätverkstrafiken eller använda enheten passivt.  </p>
            <p>När du har blivit mer bekant med hur det lokala nätverket fungerar kan du överväga att byta till rollen Router.
                En Router-nod hjälper aktivt till att bära vidare meddelanden i nätverket genom att vidarebefordra dem till
                andra enheter. Den här rollen är avgörande för att förlänga räckvidden och förbättra anslutningen, särskilt
                i områden med få användare - men den kräver bra planering mer ström och bör helst vara igång hela tiden. I
                början är det dock smartast att hålla det enkelt och börja som client.</p>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script>
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
            });
    </script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // Store all YouTube player objects keyed by their iframe's ID
        const youtubePlayers = {};
        let carouselInstance; // Store the Bootstrap carousel instance

        // This function is called automatically by the YouTube Iframe API when it's ready.
        function onYouTubeIframeAPIReady() {
            // Find all iframes with a specific class or ID pattern if you have multiple videos
            // For now, we'll assume a single video with id="youtubeVideo1"
            const videoIframes = document.querySelectorAll('iframe[id^="youtubeVideo"]');

            videoIframes.forEach(iframe => {
                const iframeId = iframe.id;
                // Ensure the src has enablejsapi=1 for API control
                if (!iframe.src.includes('enablejsapi=1')) {
                    const url = new URL(iframe.src);
                    url.searchParams.set('enablejsapi', '1');
                    url.searchParams.set('version', '3'); // Good practice for modern API
                    url.searchParams.set('rel', '0'); // To prevent related videos at the end
                    iframe.src = url.toString();
                }

                youtubePlayers[iframeId] = new YT.Player(iframeId, {
                    events: {
                        'onReady': (event) => {
                            // console.log(`Youtubeer for ${iframeId} is ready.`);
                        },
                        'onStateChange': (event) => handlePlayerStateChange(event, iframeId)
                    }
                });
            });

            setupCarouselBehavior();
        }

        // Configure carousel interactions
        function setupCarouselBehavior() {
            const carouselElement = document.getElementById('cardCarousel');
            carouselInstance = new bootstrap.Carousel(carouselElement, {
                interval: 4000 // Set your desired auto-slide interval
            });

            // Listen for the 'slide.bs.carousel' event, which fires *before* the transition starts.
            // This is the ideal place to pause the currently active video.
            carouselElement.addEventListener('slide.bs.carousel', event => {
                const currentActiveItem = carouselElement.querySelector('.carousel-item.active');
                if (currentActiveItem) {
                    const currentVideoIframe = currentActiveItem.querySelector('iframe[id^="youtubeVideo"]');
                    if (currentVideoIframe && youtubePlayers[currentVideoIframe.id]) {
                        const player = youtubePlayers[currentVideoIframe.id];
                        // Only try to pause if the player is in a state that allows it (playing or buffering)
                        const playerState = player.getPlayerState();
                        if (playerState === YT.PlayerState.PLAYING || playerState === YT.PlayerState.BUFFERING) {
                            player.pauseVideo();
                            // console.log(`Video on slide ${currentVideoIframe.id} paused.`);
                        }
                    }
                }
            });

            // Listen for 'slid.bs.carousel' if you want to perform actions on the *new* slide
            // (e.g., auto-play the video on the new slide, though this can be annoying for users)
            carouselElement.addEventListener('slid.bs.carousel', event => {
                // Example: If you wanted to auto-play the video on the new slide:
                // const newActiveItem = event.relatedTarget;
                // const newVideoIframe = newActiveItem.querySelector('iframe[id^="youtubeVideo"]');
                // if (newVideoIframe && youtubePlayers[newVideoIframe.id]) {
                //     youtubePlayers[newVideoIframe.id].playVideo();
                // }
            });
        }

        // Handle video state changes
        function handlePlayerStateChange(event, iframeId) {
            // When a video starts playing, pause the carousel
            if (event.data === YT.PlayerState.PLAYING) {
                if (carouselInstance) {
                    carouselInstance.pause();
                    // console.log(`Carousel paused because video ${iframeId} is playing.`);
                }
            }
            // When a video is paused or ended by the user, resume the carousel IF no other video is playing
            else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
                let anyVideoPlaying = false;
                for (const id in youtubePlayers) {
                    if (youtubePlayers.hasOwnProperty(id)) {
                        const player = youtubePlayers[id];
                        // Check if the player exists, is ready, and is currently playing
                        if (player && typeof player.getPlayerState === 'function' && player.getPlayerState() === YT.PlayerState.PLAYING) {
                            anyVideoPlaying = true;
                            break;
                        }
                    }
                }

                if (!anyVideoPlaying && carouselInstance) {
                    carouselInstance.cycle(); // Resume auto-cycling
                    // console.log(`Carousel resumed because video ${iframeId} paused/ended and no other videos are playing.`);
                }
            }
        }
    </script>
</body>
</html>